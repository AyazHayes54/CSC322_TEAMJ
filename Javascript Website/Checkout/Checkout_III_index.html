<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>store clerk</title>
	<link href="style.css" rel="stylesheet" type="text/css" />
  <script src = "../constants.js"></script>
  <script src = '../utility.js'></script>
  <script>
    function updateCurrentUserInfo(db, balance) {
        let transaction = db.transaction(USERS_DB_NAME, "readwrite");
        let store = transaction.objectStore(USERS_DB_NAME);
        let req = store.get(window.localStorage.getItem("email"));
        req.onsuccess = (e) => {
        let table = e.target.result;
        store.put({
          email: table.email,
          username: table.username,
          password: table.password,
          permission: table.permission,
          balance: balance
        });
      }
    }

    function start() {
      let remainingBalance = 
      (+window.localStorage.getItem("balance")) - +window.localStorage.getItem("payment");
      document.getElementById("payment").innerHTML += window.localStorage.getItem("payment");
      document.getElementById("balance").innerHTML += remainingBalance + " points.";
      window.localStorage.setItem("balance", ""+remainingBalance) // deduct purchase from balance

      window.localStorage.removeItem("payment");
      let req = window.indexedDB.deleteDatabase(CART_DB_NAME);
      req.onerror = () => console.log("Error deleting database.");
      req.onsuccess = () => console.log("Database deleted successfully");

      req = window.indexedDB.open(USERS_DB_NAME, VERSION);
      req.onsuccess = () => {
        updateCurrentUserInfo(req.result, remainingBalance);
      }
      initializeNavigation();
    }

  </script>
</head>

<body onload = "start()" class = "hg">
  <header class="hg-header"></header>
  <main class="hg-main">
    <h2>Congratulations!</h2>
    <h3>Your purchase was successful.</h3>
    <h3 id = "payment">You have been charged $</h3>
    <h3 id = "balance">Your remaining balance is </h3>
    <p>Thank you for choosing PC Emporium</p>
  </main>
  <aside id = 'links' class="hg-left"></aside>
  <aside class="hg-right">
    <h3> Hey, user! </h3>
    <h3> Logout </h3>
  </aside>
  <footer class="hg-footer"></footer>
</body>

</html>